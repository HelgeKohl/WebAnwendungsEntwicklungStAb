<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" 
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>epg</title>
    <link rel="stylesheet" href="static/css/vue-datetime.css">
    <link rel="stylesheet" href="static/css/bootstrap.css">
    <link rel="stylesheet" href="static/css/bootstrap-vue.css">
    <link rel="stylesheet" href="static/css/style.css">

    <script src="static/js/vue.js"></script>
    <script src="static/js/bootstrap-vue.js"></script>
</head>
<body>
    <div id="app">
        <!-- Navbar -->
        <b-navbar type="dark" variant="dark" class="justify-content-center">
            <b-navbar-nav>
                <b-nav-item 
                    v-bind:class="{ active: activeSide==='search'}" 
                    v-on:click="activeSide = 'search'">
                        <span class="fas fa-search"></span>
                </b-nav-item>
                <b-nav-item 
                    v-bind:class="{ active: activeSide==='result' }" 
                    v-on:click="activeSide = 'result'; requestData()">
                        <span class="fas fa-list"></span>
                </b-nav-item>
                <b-nav-item 
                    v-bind:class="{ active: activeSide==='settings' }" 
                    v-on:click="activeSide = 'settings'">
                        <span class="fas fa-user-cog"></span>
                </b-nav-item>
                <b-nav-item-dropdown text="lang" right>
                    <template v-slot:button-content>
                        <span class="fas fa-globe"></span>
                    </template>
                    <b-dropdown-item 
                        v-on:click="language = 'ger'"
                        v-bind:active="language==='ger'">
                        Deutsch
                    </b-dropdown-item>
                    <b-dropdown-item 
                        v-on:click="language = 'fre'"
                        v-bind:active="language==='fre'">
                            Französisch
                    </b-dropdown-item>
                </b-nav-item-dropdown>
            </b-navbar-nav>
        </b-navbar>
        <!-- Navbar end -->

        <!-- searchmenu -->
        <div v-if="activeSide==='search'"> 
            <b-container class="pt-3">
                <b-card no-body>
                    <b-card-header header-tag="header" class="p-0 nobackground">
                        <b-button block v-b-toggle.collapse-1>Titel, Untertitel und Beschreibung</b-button>
                    </b-card-header>
                    <b-collapse id="collapse-1" visible class="mt-2">
                        <b-card-body>
                            <b-button class="mb-3" 
                                    v-on:click="addKeywordInput">
                                Stichwortsuche hinzufügen
                            </b-button>
                            <!-- keyword search -->
                            <div v-for="item in keywords.data">
                                <!-- selectiontype -->
                                <b-input-group class="mt-3">
                                    <!-- concat type -->
                                    <select class="form-control"
                                            v-if="keywords.data.indexOf(item) != 0"
                                            v-model:value="item.concatType">
                                        <option v-bind:value="'AND'">und</option>
                                        <option v-bind:value="'OR'">oder</option>
                                    </select>
                                    <!-- negation -->
                                    <select class="form-control"
                                            v-model:value="item.negate">
                                        <option v-bind:value="false">enthält</option>
                                        <option v-bind:value="true">enthält nicht</option>
                                    </select>
                                    <!-- remove item -->
                                    <div class="input-group-append">
                                        <b-button class="form-controll"
                                                v-bind:disabled="keywords.data.indexOf(item) == 0"
                                                v-on:click="removeKeywordInput(item)">
                                            <span class="fas fa-trash-alt"></span>
                                        </b-button>
                                    </div>
                                </b-input-group>
                                <!-- selection -->
                                <b-input-group class="mb-2">
                                    <template v-slot:prepend>
                                        <select class="form-control" 
                                                v-model:value="item.type">
                                            <option v-bind:value="'title'">Titel</option>
                                            <option v-bind:value="'subtitle'">Untertitel</option>
                                            <option v-bind:value="'desc'">Beschreibung</option>
                                        </select>
                                    </template>
                                    <!-- input -->
                                    <b-form-input type="text" 
                                        v-bind:list="'keyword-list-' + item.id"
                                        v-model:value="item.input" 
                                        class="form-control">
                                    </b-form-input>
                                    <datalist v-bind:id="'keyword-list-' + item.id">
                                        <option>test</option>
                                        <!-- <option v-for="size in sizes">{{ size }}</option> -->
                                    </datalist>
                                </b-input-group>
                            </div>
                        </b-card-body>
                    </b-collapse>
                </b-card>
            </b-container>
            <!-- keyword search end -->
            <!-- channel -->
            <b-container class="pt-3">
                <b-card no-body>
                    <b-card-header header-tag="header" class="p-0 nobackground">
                        <b-button block v-b-toggle:collapse-2>Sender</b-button>
                    </b-card-header>
                    <b-collapse id="collapse-2" class="mt-2">
                        <b-card-body>
                            <b-button class="mb-3" 
                                    v-on:click="addChannelInput">
                                Sender hinzufügen
                            </b-button>
                            <div v-for="item in channels.data">
                                <!-- selectiontype -->
                                <b-input-group class="mt-3">
                                    <!-- concat type -->
                                    <select class="form-control"
                                            v-if="channels.data.indexOf(item) != 0"
                                            v-model:value="item.concatType">
                                        <option v-bind:value="'AND'">und</option>
                                        <option v-bind:value="'OR'">oder</option>
                                    </select>
                                    <!-- negation -->
                                    <select class="form-control"
                                            v-model:value="item.negate">
                                        <option v-bind:value="false">enthält</option>
                                        <option v-bind:value="true">enthält nicht</option>
                                    </select>
                                    <!-- remove item -->
                                    <div class="input-group-append">
                                        <b-button class="form-controll"
                                                v-bind:disabled="channels.data.indexOf(item) == 0"
                                                v-on:click="removeChannelInput(item)">
                                            <span class="fas fa-trash-alt"></span>
                                        </b-button>
                                    </div>
                                </b-input-group>
                                <!-- selection -->
                                <b-input-group class="mb-2">
                                    <!-- input -->
                                    <b-form-input type="text"
                                        v-bind:list="'channel-list-' + item.id"
                                        v-model:value="item.input" 
                                        class="form-control">
                                    </b-form-input>
                                    <datalist v-bind:id="'channel-list-' + item.id">
                                        <!-- <option v-for="size in sizes">{{ size }}</option> -->
                                    </datalist>
                                </b-input-group>
                            </div>
                        </b-card-body>
                    </b-collapse>
                </b-card>
                
            </b-container>
            <!-- channel end -->
            <!-- date -->
            <!-- TODO: add reset -->
            <b-container class="pt-3">
                <b-card no-body>
                    <b-card-header header-tag="header" class="p-0 nobackground">
                        <b-button block v-b-toggle.collapse-3>Datum</b-button>
                    </b-card-header>
                    <b-collapse id="collapse-3" visible class="mt-2">
                        <b-card-body>
                            <label>Start:</label>
                            <div class="daterangebutton mb-2">
                                <b-button variant="secondary" v-on:click="changeTime('start', start.from, 'Vormittag')">
                                    Vormittag
                                </b-button>
                                <b-button variant="secondary" v-on:click="changeTime('start', start.from, 'Nachmittag')">
                                    Nachmittag
                                </b-button>
                                <b-button variant="secondary" v-on:click="changeTime('start', start.from, 'Abend')">
                                    Abend
                                </b-button>
                                <b-button variant="secondary" v-on:click="changeTime('start', start.from, 'Nacht')">
                                    Nacht
                                </b-button>
                            </div>
                            <b-row class="daterange">
                                <b-col class="daterange">
                                    <label>von:</label>
                                    <datetime 
                                        zone='local'
                                        value-zone='local'
                                        type="datetime" 
                                        :placeholder="'Start'" 
                                        v-model="start.from"
                                        :phrases="{ok: 'OK', cancel: 'Abbruch'}"
                                        class="mb-3">
                                    </datetime>
                                </b-col>
                                <b-col class="daterange">
                                    <label>bis:</label>
                                    <datetime 
                                        zone='local'
                                        value-zone='local'
                                        type="datetime"     
                                        :placeholder="'Ende'"
                                        v-model="start.till"
                                        :phrases="{ok: 'OK', cancel: 'Abbruch'}"
                                        class="mb-3">
                                    </datetime>
                                </b-col>
                            </b-row>
                            <label>Ende:</label>
                            <div class="daterangebutton mb-2">
                                <b-button variant="secondary" v-on:click="changeTime('stop', stop.from, 'Vormittag')">
                                    Vormittag
                                </b-button>
                                <b-button variant="secondary" v-on:click="changeTime('stop', stop.from, 'Nachmittag')">
                                    Nachmittag
                                </b-button>
                                <b-button variant="secondary" v-on:click="changeTime('stop', stop.from, 'Abend')">
                                    Abend
                                </b-button>
                                <b-button variant="secondary" v-on:click="changeTime('stop', stop.from, 'Nacht')">
                                    Nacht
                                </b-button>
                            </div>
                            <b-row class="daterange">
                                <b-col class="daterange">
                                    <label>von:</label>
                                    <datetime 
                                        zone='local'
                                        value-zone='local'
                                        type="datetime" 
                                        :placeholder="'Start'" 
                                        v-model="stop.from"
                                        :phrases="{ok: 'OK', cancel: 'Abbruch'}"
                                        class="mb-3">
                                    </datetime>
                                </b-col>
                                <b-col class="daterange">
                                    <label>bis:</label>
                                    <datetime 
                                        zone='local'
                                        value-zone='local'
                                        type="datetime"     
                                        :placeholder="'Ende'"
                                        v-model="stop.till"
                                        :phrases="{ok: 'OK', cancel: 'Abbruch'}"
                                        class="mb-3">
                                    </datetime>
                                </b-col>
                            </b-row>
                        </b-card-body>
                    </b-collapse>
                </b-card>
            </b-container>
            <!-- date end -->
        </div>
        <!-- searchmenu end -->
        <!-- result menu -->
        <div v-if="activeSide==='result'"> 
            <template>
                <div class="overflow-auto">
                    <!-- pagination -->
                    <div class="mt-3">
                        <b-pagination
                            v-model="queryResult.currentPage"
                            :total-rows="queryResult.numFound"
                            :per-page="queryResult.perPage"
                            pills
                            first-text="‹‹"
                            last-text="››"
                            align="center">
                        </b-pagination>
                    </div>
                    <!-- content -->
                    <b-container v-if="Object.keys(queryResult.data).length === 0">
                        <b-card>
                            <h4 style="text-align: center;">Keine Sendungen gefunden!</h4>
                        </b-card>
                    </b-container>
                    <b-container v-for="item in queryResult.data" v-bind:key="item.id">
                        <b-card no-body class="mb-1">
                            <b-card-header 
                                header-tag="header" 
                                class="p-0 nobackground">
                                <b-button block v-b-toggle="'collapse-' + item.id">
                                        <table>
                                            <td class="first">
                                                <img
                                                    v-bind:src="
                                                        'static/img/senderlogos/' 
                                                        + item.logofile" 
                                                    v-bind:alt="item.channel">
                                                </img>
                                            </td>
                                            <td>
                                                <h5 style="text-align: left;">
                                                    <div v-if="language === 'ger'" v-html="item.title_ger"></div>
                                                    <div v-if="language === 'fre'" v-html="item.title_fre"></div>
                                                </h5>
                                            </td>
                                            <td class="last">
                                                <span>
                                                    <span v-if="parseStrToDate(item.start) != parseStrToDate(item.stop)">
                                                    {{ parseStrToDate(item.start) }} - {{ parseStrToDate(item.stop) }}
                                                    </span>
                                                    <span v-else>{{ parseStrToDate(item.start) }}</span>
                                                    <span>{{ parseStrToTime(item.start) }}-{{ parseStrToTime(item.stop) }}</span>
                                                </span>
                                            </td>
                                        </table>  
                                </b-button>
                            </b-card-header>

                            <b-collapse v-bind:id="'collapse-' + item.id">
                                <b-card-body>
                                    <b-card-text>
                                        <strong>
                                            <div v-if="language === 'ger'" v-html="item.subtitle_ger"></div>
                                            <div v-if="language === 'fre'" v-html="item.subtitle_fre"></div>
                                        </strong>
                                        <div v-if="language === 'ger'" v-html="item.desc_ger"></div>
                                        <div v-if="language === 'fre'" v-html="item.desc_fre"></div>
                                    </b-card-text>
                                </b-card-body>
                            </b-collapse>
                        </b-card>
                    </b-container>
                </div>
            </template>
        </div>
        <!-- result menu end -->
        <!-- settings menu -->
        <div v-if="activeSide==='settings'"> 
            <b-container class="pt-3">
                <b-card no-body>
                    <b-card-header header-tag="header" class="p-0 nobackground">
                        <b-button block v-b-toggle.collapse-3>Datum</b-button>
                    </b-card-header>
                    <b-collapse id="collapse-3" visible class="mt-2">
                        <b-card-body>
                            <label>Heute:</label>
                            <datetime 
                                zone='local'
                                value-zone='local'
                                type="date" 
                                v-model="today"
                                :phrases="{ok: 'OK', cancel: 'Abbruch'}"
                                class="mb-3">
                            </datetime>
                        </b-card-body>
                    </b-collapse>
                </b-card>
            </b-container>
        </div>
        <!-- settings menu end -->
    </div>
    
    <script src="static/js/luxon.js"></script>
    <script src="static/js/vue-datetime.js"></script>
    <script src="static/js/main.js"></script>
    <script src="https://kit.fontawesome.com/072a7506e7.js" 
            crossorigin="anonymous">
    </script>
    <script src="static/js/axios.js"></script>
</body>
</html>